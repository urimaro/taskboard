<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="style.css" type="text/css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
		<script type="text/babel">
		// 付箋要素生成
		var Task = React.createClass({
			render: function() {
				return (
					<div>
						{this.props.dataTaskTitle}
						{this.props.children}
					</div>
				);
			}
		});

		// リスト生成
		var TaskList = React.createClass({
			componentDidMount: function(){
				this.fetchData();
			},
			getInitialState: function(){
				return {
					datas: [
						{id: 1, title: "データ無し"}
					]
				};
			},
			fetchData: function(){
				fetch(this.props.dataPass)
				.then((response) => response.json())
				.then((responseData) => {
					this.setState({
						datas: responseData
					});
				})
			},
			deleteData(e){
				var id  = e.currentTarget.getAttribute('id');
				fetch('/tasks/' + id, {method: 'DELETE'})
				.then((responseData) => {
					this.setState({
						datas: this.state.datas.filter((data) => {
							return data.id != id;
						})
					});
				})
			},
			render: function() {
				return (
					<div>
						<h1>{this.props.dataType}</h1>
						<div className="postit">
							{this.state.datas.map((data) => {
								return (
									<Task dataTaskTitle={data.title}>
										<input id={data.id} className="delete" type="button" value="☓" onClick={this.deleteData}/>
									</Task>
								)
							})}
						</div>
					</div>
				);
			}
    });

		ReactDOM.render(<TaskList dataPass="todo"  dataType="Todo"/>, document.getElementById('todo'));
		ReactDOM.render(<TaskList dataPass="doing" dataType="Doing"/>,document.getElementById('doing'));
		ReactDOM.render(<TaskList dataPass="done"  dataType="Done"/>, document.getElementById('done'));

		</script>
	</head>
	<body>
		<div id="todo"  class="swimlane"></div>
		<div id="doing" class="swimlane"></div>
		<div id="done"  class="swimlane"></div>
	</body>
</html>
